/*! Complex Meta Fields - v1.0.5
 * http://eney-solutions.com.ua/complex-meta-fields
 * Copyright (c) 2014; * Licensed GPLv2+ */
(function(e){"use strict";var t=function(){return{key:"",label:""}},i=function(){return{input:"text",name:"",options:[new t]}},n=function(){return{show:!0,name:"New FieldSet",post_type:"post",options:[new i]}};e.cmf=angular.module("cmfApp",["slugifier","ui.tinymce"]).controller("cmfWorkspace",function(e,o){e.is_loading=!1,e.getFieldSets=function(){e.is_loading=!0,o.get(ajaxurl+"?action=cmf_get_fieldsets").success(function(t){e.fieldsets=t,e.is_loading=!1})},e.addFieldSet=function(e){e.push(new n)},e.removeFieldSet=function(e,t){confirm(cmfL10N.sure)&&e.splice(t,1)},e.removeFieldValue=function(e,t){confirm(cmfL10N.sure)&&e.splice(t,1)},e.addField=function(e){e.push(new i)},e.addFieldValue=function(e){e.push(new t)},e.removeField=function(e,t){confirm(cmfL10N.sure)&&e.splice(t,1)},e.fieldHasValues=function(e){return-1!==["select","radio","checkbox"].indexOf(e.input)}}).controller("cmfHelp",function(e){e.sections={},e.init=function(t){e.sections=t},e.toggleSection=function(t){for(var i in e.sections)e.sections[i]=!1;e.sections[t]=!0}}).controller("cmfMetaBox",function(e,t){e.templates_url=cmfL10N.templates_url,e.l10n=cmfL10N.cmfMetaBox,e.fieldsets=[],e.initialize=function(t,i){e._filterFormat(t),e.template=i,e.fieldsets=t},e.addFieldSet=function(t){t.push(angular.copy(e.template))},e.removeFieldSet=function(e,t){confirm(cmfL10N.sure)&&e.splice(t,1)},e._filterFormat=function(e){for(var t in e)for(var i in e[t].options)"date"===e[t].options[i].input&&(e[t].options[i].value=new Date(e[t].options[i].value)),"number"===e[t].options[i].input&&(e[t].options[i].value=Number(e[t].options[i].value))},e.selectImage=function(){var t=this,i=wp.media.frames.file_frame=wp.media({multiple:!1});i.on("select",function(){var n=i.state().get("selection").first().toJSON();t.field.value=n.id,t.field.thumb=n.sizes.thumbnail.url,e.$apply()}),i.open()},e.removeImage=function(){this.field.value=null,this.field.thumb=null},e.initImage=function(){var e=this;t.get(ajaxurl+"?action=cmf_get_attachment_thumbnail&id="+this.field.value).success(function(t){t.success&&(e.field.thumb=t.data)})}})})(this);